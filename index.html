<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gia phả dòng họ Nguyễn Bá - xã Hoàng Sơn, huyện Nông Cống, tỉnh Thanh Hóa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        a {
            text-decoration: none;
            color: #0066cc;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        /* Header Styles */
        header {
            background-color: #fff;
            padding: 30px 0 20px;
            text-align: center;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .blog-title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 30px;
            color: #333;
        }
        
        .author-info {
            margin-bottom: 20px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 30px;
            text-align: left;
        }
        
        .avatar-container {
            width: 120px;
            height: 120px;
            min-width: 120px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #f0f5ff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .author-text-content {
            display: flex;
            flex-direction: column;
        }
        
        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .author-name {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .author-title {
            font-size: 1rem;
            color: #666;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        .author-description {
            font-size: 1rem;
            color: #555;
            margin-bottom: 15px;
            line-height: 1.6;
            padding: 0;
            display: none;
            overflow: hidden;
            transition: all 0.3s ease;
            opacity: 0;
            max-height: 0;
            text-align: left;
            width: 100%;
        }
        
        .author-description.active {
            display: block;
            opacity: 1;
            max-height: 500px;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        
        .about-me-btn {
            display: inline-block;
            padding: 6px 15px;
            background-color: #f0f5ff;
            color: #0066cc;
            border: 1px solid #0066cc;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 5px;
            align-self: flex-start;
        }
        
        .about-me-btn:hover {
            background-color: #0066cc;
            color: white;
            text-decoration: none;
        }
        
        .about-me-btn i {
            margin-right: 5px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f0f5ff;
            color: #0066cc;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }
        
        .social-btn:hover {
            background-color: #0066cc;
            color: #fff;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            text-decoration: none;
        }
        
        .social-tooltip {
            position: relative;
        }
        
        .social-tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            white-space: nowrap;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
        }
        
        .social-tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .social-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Content Styles */
        .content {
            padding: 60px 0;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            color: #333;
        }
        
        .posts-container {
            margin-top: 60px;
        }
        
        .category-row {
            margin-bottom: 60px;
        }
        
        .category-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0066cc;
            color: #333;
        }
        
        .post-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .post-card {
            background-color: #fff;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .post-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .post-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            /* Giới hạn số dòng hiển thị tiêu đề */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.5;
            min-height: 3rem;
            height: auto;
            max-height: 3rem;
        }
        
        .post-excerpt {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
            /* Giới hạn số dòng hiển thị đoạn trích */
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 4.5rem; /* Chiều cao cố định cho 3 dòng */
            flex-grow: 1; /* Cho phép excerpt mở rộng để điền khoảng trống */
        }
        
        .post-meta {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            color: #888;
            font-size: 0.85rem;
            margin-top: auto; /* Đẩy post-meta xuống dưới cùng */
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }
        
        .post-meta-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
        
        .post-meta-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .post-date {
            display: flex;
            align-items: center;
        }
        
        .post-date i {
            margin-right: 5px;
        }
        
        .post-category {
            background-color: #f0f5ff;
            color: #0066cc;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s ease;
        }
        
        .post-category:hover {
            background-color: #0066cc;
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
        }
        
        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            max-width: 70%; /* Giới hạn chiều rộng để không chiếm quá nhiều không gian */
        }
        
        .read-more {
            display: inline-block;
            color: #0066cc;
            font-weight: 500;
            text-align: right;
            white-space: nowrap;
        }
        
        .view-all {
            display: block;
            text-align: center;
            margin-top: 50px;
            margin-bottom: 20px;
        }
        
        .view-all-btn {
            display: inline-block;
            padding: 10px 25px;
            background-color: #0066cc;
            color: white;
            border-radius: 5px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .view-all-btn:hover {
            background-color: #0052a3;
            text-decoration: none;
        }
        
        /* About Section */
        .about-section {
            background-color: #fff;
            padding: 60px 0;
            margin-top: 60px;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.05);
        }
        
        .about-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .about-description {
            margin-bottom: 30px;
            color: #555;
            font-size: 1.1rem;
        }
        
        /* Contact Section */
        .contact-section {
            padding: 60px 0;
            background-color: #f0f5ff;
            text-align: center;
        }
        
        .contact-info {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
        }
        
        .contact-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .contact-icon {
            font-size: 2rem;
            color: #0066cc;
            margin-bottom: 15px;
        }
        
        /* Footer */
        footer {
            background-color: #333;
            color: #fff;
            padding: 30px 0;
            text-align: center;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .copyright {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Loading indicator */
        .loading-indicator {
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 102, 204, 0.3);
            border-radius: 50%;
            border-top-color: #0066cc;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .post-grid {
                grid-template-columns: 1fr;
            }
            
            .contact-info {
                flex-direction: column;
                gap: 20px;
            }
            
            .blog-title {
                font-size: 2.2rem;
            }
            
            .author-name {
                font-size: 1.4rem;
            }
            
            .author-info {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .about-me-btn {
                align-self: center;
            }
        }
        
        .post-tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: #eef5ff;
            color: #0066cc;
            border-radius: 3px;
            font-size: 0.75rem;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .post-tag:hover {
            background-color: #0066cc;
            color: white;
            transform: translateY(-2px);
            text-decoration: none;
        }
        
        /* Navigation menu styles */
        .navigation-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .nav-item {
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #555;
        }
        
        .nav-item:hover {
            background-color: #f0f5ff;
            color: #0066cc;
            text-decoration: none;
        }
        
        .nav-item.active {
            background-color: #0066cc;
            color: white;
        }
        
        /* Responsive styles for navigation */
        @media (max-width: 768px) {
            .navigation-menu {
                flex-wrap: wrap;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <!-- Thêm menu điều hướng -->
                <div class="navigation-menu">
                    <a href="index.html" class="nav-item active">Trang chủ</a>
                    <a href="family-tree.html" class="nav-item">Gia phả</a>
                    <a href="all-posts.html" class="nav-item">Tất cả bài viết</a>
                </div>
                
                <div class="author-info">
                    <div class="avatar-container">
                       <img src="profile2.jpg" alt="Avatar" class="avatar-img"> 
                    </div>
                    <div class="author-text-content">
                        <h2 class="author-name">Xin Chào</h2>
                        <p class="author-title"></p>
                        
                        <p id="author-description" class="author-description">
                        </p>
                        
                        <div class="social-links">
                            <a href="https://www.facebook.com/tungnb/" class="social-btn social-tooltip" title="Facebook">
                                <i class="fab fa-facebook-f"></i>
                                <span class="tooltip-text">Facebook</span>
                            </a>
                            <a href="mailto:tungnguyen@mayhoangtung.com" class="social-btn social-tooltip" title="Email">
                                <i class="fas fa-envelope"></i>
                                <span class="tooltip-text">tungnguyen@mayhoangtung.com</span>
                            </a>
                            <a href="tel:0983887485" class="social-btn social-tooltip" title="Điện thoại">
                                <i class="fas fa-phone"></i>
                                <span class="tooltip-text">0983887485</span>
                            </a>
                            <button id="about-me-btn" class="about-me-btn">
                                <i class="fas fa-user"></i> Về tôi
                            </button>
                        </div>
                        
                       
                    </div>
                </div>
                
                <!--<p id="author-description" class="author-description">
                    Thích công nghệ nhưng lại học NEU và làm công ty may. Và AI đã giúp tôi trở lại với đam mê đó. Hãy coi như là nhật ký lưu trữ công khai. Tạo website này cũng như thả 1 giọt nước mưa xuống biển cả internet. Nếu bạn tình cờ thấy website này, hãy xem như đó là bí mật của 2 ta.
                    
                </p>-->
            </div>
        </div>
    </header>

    <section class="content">
        <div class="container">
            
            <div id="loading-indicator" class="loading-indicator">
                <div class="loading-spinner"></div>
                <p>Đang tải bài viết...</p>
            </div>
            
            <div id="posts-container" class="posts-container" style="display: none;">
                <div class="post-grid" id="recent-posts">
                    <!-- Bài viết mới nhất sẽ được thêm vào đây -->
                </div>
            </div>
            
            <div class="view-all">
                <a href="all-posts.html" class="view-all-btn">Xem Tất Cả Bài Viết</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p class="copyright">Tạo vào © 2025 với sự trợ giúp của Claude</p>
            </div>
        </div>
    </footer>

    <script>
        // Lấy danh sách bài viết từ API
        async function getPosts() {
            try {
                const response = await fetch('/api/posts');
                
                if (!response.ok) {
                    throw new Error(`Lỗi khi lấy dữ liệu: ${response.status}`);
                }
                
                const posts = await response.json();
                
                // Trả về chỉ các bài viết đã xuất bản
                return posts.filter(post => post.status === 'published');
            } catch (error) {
                console.error('Error fetching posts:', error);
                
                // Fallback sử dụng localStorage nếu API bị lỗi
                const posts = JSON.parse(localStorage.getItem('blog-posts') || '[]');
                return posts.filter(post => post.status === 'published');
            }
        }
        
        // Xử lý nút About Me
        document.addEventListener('DOMContentLoaded', function() {
            const aboutMeBtn = document.getElementById('about-me-btn');
            const authorDescription = document.getElementById('author-description');
            
            if (aboutMeBtn && authorDescription) {
                aboutMeBtn.addEventListener('click', function() {
                    authorDescription.classList.toggle('active');
                    if (authorDescription.classList.contains('active')) {
                        aboutMeBtn.innerHTML = '<i class="fas fa-times"></i> Đóng';
                    } else {
                        aboutMeBtn.innerHTML = '<i class="fas fa-user"></i> Về tôi';
                    }
                });
            }
            
            // Tiếp tục các hàm DOMContentLoaded hiện có
            loadPosts();
        });
        
        // Hàm tải bài viết đã di chuyển từ event listener
        async function loadPosts() {
            try {
                // Hiển thị chỉ báo đang tải
                document.getElementById('loading-indicator').style.display = 'block';
                document.getElementById('posts-container').style.display = 'none';
                
                // Lấy danh sách bài viết
                let posts = await getPosts();
                
                // Sắp xếp bài viết theo thời gian (mới nhất đầu tiên)
                posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Lấy 9 bài viết mới nhất
                const recentPosts = posts.slice(0, 9);
                
                // Kiểm tra nếu không có bài viết nào
                if (recentPosts.length === 0) {
                    const noPostsMessage = document.createElement('p');
                    noPostsMessage.style.textAlign = 'center';
                    noPostsMessage.style.padding = '40px 0';
                    noPostsMessage.style.color = '#666';
                    noPostsMessage.textContent = 'Chưa có bài viết nào được đăng.';
                    document.getElementById('posts-container').appendChild(noPostsMessage);
                } else {
                    // Hiển thị bài viết mới nhất
                    renderPosts('recent-posts', recentPosts);
                }
                
                // Ẩn loading và hiển thị nội dung
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('posts-container').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('loading-indicator').style.display = 'none';
                
                const errorMessage = document.createElement('p');
                errorMessage.style.textAlign = 'center';
                errorMessage.style.padding = '40px 0';
                errorMessage.style.color = '#e74c3c';
                errorMessage.textContent = `Lỗi khi tải bài viết: ${error.message}`;
                document.getElementById('posts-container').appendChild(errorMessage);
                document.getElementById('posts-container').style.display = 'block';
            }
        }
        
        // Hiển thị danh sách bài viết
        function renderPosts(containerId, posts) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (posts.length === 0) {
                const emptyMessage = document.createElement('p');
                emptyMessage.style.gridColumn = '1 / -1';
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.color = '#666';
                emptyMessage.textContent = 'Chưa có bài viết nào.';
                container.appendChild(emptyMessage);
                return;
            }
            
            posts.forEach(post => {
                // Tạo tóm tắt từ nội dung HTML
                let excerpt = '';
                if (post.content) {
                    // Loại bỏ HTML tags để tạo excerpt
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = post.content;
                    excerpt = tempDiv.textContent || tempDiv.innerText || '';
                    // Giới hạn đoạn trích đến 150 ký tự (khoảng 3 dòng)
                    excerpt = excerpt.substring(0, 120) + (excerpt.length > 120 ? '...' : '');
                }
                
                const postCard = document.createElement('div');
                postCard.className = 'post-card';
                
                // HTML cho bài viết
                let featuredImage = post.featuredImage ? 
                    `<img src="${post.featuredImage}" alt="${post.title}" class="post-image" loading="lazy">` : 
                    `<div class="post-image" style="background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-image" style="font-size: 3rem; color: #ddd;"></i>
                    </div>`;
                
                // Tạo HTML cho tags (nếu có)
                let tagsHTML = '';
                if (post.tags) {
                    // Kiểm tra xem post.tags có phải là mảng hay không
                    let tagsArray = [];
                    
                    if (Array.isArray(post.tags)) {
                        tagsArray = post.tags;
                    } else if (typeof post.tags === 'string') {
                        // Nếu tags là chuỗi, tách nó thành mảng
                        tagsArray = post.tags.split(',').map(tag => tag.trim());
                    }
                    
                    if (tagsArray.length > 0) {
                        tagsHTML = '<div class="post-tags">';
                        tagsArray.forEach(tag => {
                            if (tag) { // Chỉ thêm tag nếu nó không rỗng
                                tagsHTML += `<a href="all-posts.html?tag=${tag}" class="post-tag">#${tag}</a>`;
                            }
                        });
                        tagsHTML += '</div>';
                    }
                }
                
                postCard.innerHTML = `
                    ${featuredImage}
                    <div class="post-content">
                        <h3 class="post-title">${post.title}</h3>
                        <p class="post-excerpt">${excerpt}</p>
                        <div class="post-meta">
                            <div class="post-meta-left">
                                <!-- Đã loại bỏ hiển thị danh mục -->
                            </div>
                            <span class="post-date"><i class="far fa-calendar-alt"></i> ${formatDate(post.date)}</span>
                        </div>
                        <div class="post-meta-bottom">
                            ${tagsHTML || '<div class="post-tags"></div>'}
                            <a href="posts/view.html?id=${post.id}" class="read-more">Đọc tiếp →</a>
                        </div>
                    </div>
                `;
                
                container.appendChild(postCard);
            });
        }
        
        // Định dạng ngày tháng
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return dateString; // Trả về nguyên gốc nếu không phải ngày hợp lệ
                }
                
                return date.toLocaleDateString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            } catch (error) {
                return dateString; // Trả về nguyên gốc nếu có lỗi
            }
        }
    </script>
</body>
</html>
